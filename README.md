## Pull-up Magnetic Levitation 上拉式磁悬浮

https://github.com/user-attachments/assets/98f3b621-be2c-473f-b661-d730cdc24fd0

## 介绍

目前有两种常见的磁悬浮种类:`上拉式`和`下推式`。

`下推式`磁悬浮一般是依靠4个电磁铁在中心形成一个陷阱位置，如果仅考虑悬浮不考虑悬浮高度，不需要调节PID。

在这个项目中是`上拉式`，难度相对于`下推式`高一些，需要通过PID使下方的此提案保持动态悬浮。

我主要尝试了两种方案：`霍尔传感器方案`和`红外传感器方案`。其中`霍尔传感器方案`完全调试成功了，并录制的演示视频。`红外传感器方案`悬浮时间比较短，PID没有调好。

这里分享我的代码、磁悬浮装置制作材料清单、制作经验等，希望可以帮助到大家快速制作一个。

## 材料清单见：

霍尔传感器方案：Hall Sensor(Verified)/Materials list.xlsx

红外传感器方案：Infrared Sensor/Materials list.xlsx

## 基本原理

<img width="340" height="294" alt="yuanlitu" src="https://github.com/user-attachments/assets/675ffbab-2eb2-4cd2-a70a-ff97e0d4431d" />


上图展示了上拉式磁悬浮的基本原理。上面的电磁铁提供吸引力来抵消磁铁片浮子的重力。

我们首先需要找到一个浮子刚好被抵消重力的位置，从单片机中读取当时的参数`AdjustValue`（霍尔传感器的值或者红外传感器的值）。好处就是电磁线圈只需要提供相对比较小的力就可以让浮子保持在平衡位置。

浮子悬浮的过程是动态的，浮子往上跑就控制线圈给浮子排斥力，相反就给吸引力。霍尔传感器和红外传感器非常敏感，浮子微小的位置变化都可以被探测出来，从而通过控制算法可以使浮子相对稳定的悬浮在空中。

## 方案一：霍尔传感器方案（已验证可行）

<img width="480" height="338" alt="Snipaste_2025-08-13_13-11-54" src="https://github.com/user-attachments/assets/4854adeb-6c4f-4382-b2f4-7c9be46ca472" />

### 重点物料说明：

#### 1. Arduino Uno
<img width="150" height="150" alt="image" src="https://github.com/user-attachments/assets/16e8553b-64b4-43af-8ff5-58be4161c2f4" />


#### 2. 线圈
`0.5mm 50m线圈`，直接淘宝购买整卷的即可，整体电阻约为5Ω，电流最好不要超过4A。

#### 3. 霍尔传感器

`49E`，霍尔传感器可以探测附近磁场变化并且输出电压信号，非常适合用来探测浮子的位置变化。

#### 4. 电机驱动模块

`L298N`，可以进行全桥DC电机控制，让arduino可以通过一个小电流去控制大电流（线圈）。

#### 5. 磁铁

`钕磁铁`，浮子本身就是磁铁。如果纯铁的话，需要的磁力比较大，电磁铁中需要的电流也会更大，发热会更严重。

#### 6. 续流二极管
`SR5100`，非常重要，一定要有，否则容易导致元件烧毁。

### 电路原理图
<img width="548" height="397" alt="Principle" src="https://github.com/user-attachments/assets/b2291978-13d6-4bc2-8428-0fbc1ec399ef" />


### 软件环境
单片机: arduino UNO

开发环境: Arduino


## 方案二：红外传感器方案（未验证成功）

主要影响因素，在红外方案中，由于采用了红外测距，受环境和光照影响比较大。磁铁片浮子上端应粘贴白色纸张，以形成漫反射。

注意：该方案磁铁片在悬浮的过程中容易左右抖动，可能导致反射光强抖动，并引发pid抖动，形成正反馈，最终导致崩溃掉落，可能是未验证成功的原因之一。

![demo2](https://github.com/user-attachments/assets/2d1d7b84-eb84-42ab-a5a2-af76e7b98e07)

https://github.com/user-attachments/assets/2d70b275-bb18-49ee-bdcb-ad9cc3a21a82


### 重点物料说明：

#### 1. STM32F103C8T6最小系统
<img width="151" height="103" alt="image" src="https://github.com/user-attachments/assets/1dfde959-1c1e-4c99-b4fd-a649c38be6cb" />


#### 2. 线圈
`0.5mm 50m线圈`，直接淘宝购买整卷的即可，整体电阻约为5Ω，电流最好不要超过4A。

#### 3. TCRT5000红外传感器

`49E`，霍尔传感器可以探测附近磁场变化并且输出电压信号，非常适合用来探测浮子的位置变化。

#### 4. PC817光耦 + IRFI3205 MOS管

让arduino可以通过一个小电流去控制大电流（线圈）。

#### 5. 磁铁

`钕磁铁`，浮子本身就是磁铁。如果纯铁的话，需要的磁力比较大，电磁铁中需要的电流也会更大，发热会更严重。


#### 6.12V->5V
`三端稳压管LM7805`，主要是为了将12V电源，降压为5V，为最小系统供电。对于12V电源，可以直接购买可调电源，应该也可以采用快充诱骗。

### 电路原理图
<img width="1261" height="780" alt="Principle" src="https://github.com/user-attachments/assets/24320732-ffcc-4522-82ff-e7818a3d1490" />



### 软件环境
单片机:STM32f103c8t6

开发环境:STM32CubeIDE

## 算法调试部分

源码比较简单，有几个点需要注意一下：

#### 1. 确定`AdjustValue`: 

装置制作好之后，拿着浮子放到线圈下方，不断调整位置，直到有个位置浮子重力即将被抵消，这个位置就作为平衡点位置 `AdjustValue` （读取到的霍尔传感器的值或者红外传感器的值），位于真正的平衡点稍微上一点点。这样一来，只需要驱动线圈给浮子斥力，浮子重力完全由上方的磁铁抵消。

一般来说，在目标位置需要磁力<=重量，但是有不能小太多。如果P调到最大，电流最大输出了，磁力还是<重量，无法吸起磁铁片浮子，则不可能悬浮。必须保证磁力刚刚好可以跟重量抵消，同时留有PID调节的裕量。

可以通过Arduino IDE自带的串口监视器或者绘图器来确定具体值。

#### 2. PID参数整定:

P的整定：先调P值，从小到大开始试，当P很小的时候，手持浮子向线圈慢慢靠近并不会感受到线圈对浮子的斥力，增大P值慢慢会感觉到线圈对浮子的力，继续增加P值，直到P达到一个临界值，刚好让浮子在线圈对作用力之下能上下晃动一两下，不会持续很多次，能在手不施力的情况下因为线圈和重力能上下晃动一两下就够了，证明此时的P值能够使线圈提供足够的斥力，让浮子不被上面的磁铁吸上去。（也可以把P稍微再调大一点，影响不大，如果震动非常剧烈，是不行的）

D的整定：在P值确定后，用同样的方式从小到大寻找D值，建议指数增长，而不是线性增长，比如先在0.001到0.1之间试两三个数，然后0.1到1之间试几个数，然后1-10以此类推。随着D的增大能逐渐感觉到浮子可以越来越稳定地悬浮起来。当再增大D反而导致更不稳定的时候，就说明之前的D已经是最合适的值了。

I的整定：如果你对于悬浮的目标值没有要求，则可以不调节I。如果要求磁铁一定要悬浮的目标位置，则需要调节I。如果有没I，则控制是存在静态误差的（也就是稳定位置和目标位置有一个静态的差值），通过I的整定可以消除。

如果怎么增大P或者D都不见好转，可以考虑乘以-1，来避免代码中方向弄反。

#### 3. 滤波：

由于霍尔传感器和红外传感器都很敏感，加上周围环境造成的波动，想要读取到一个稳定的值需要进行滤波处理。这里我使用的就是取平均值的方式，简单粗暴。








